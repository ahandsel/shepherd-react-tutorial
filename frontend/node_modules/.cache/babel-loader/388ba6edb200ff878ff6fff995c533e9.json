{"ast":null,"code":"\"use strict\";\n\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __rest = this && this.__rest || function (s, e) {\n  var t = {};\n\n  for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0) t[p] = s[p];\n\n  if (s != null && typeof Object.getOwnPropertySymbols === \"function\") for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) {\n    if (e.indexOf(p[i]) < 0 && Object.prototype.propertyIsEnumerable.call(s, p[i])) t[p[i]] = s[p[i]];\n  }\n  return t;\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.KintoneResponseHandler = void 0;\n\nvar KintoneAbortSearchError_1 = require(\"./error/KintoneAbortSearchError\");\n\nvar KintoneRestAPIError_1 = require(\"./error/KintoneRestAPIError\");\n\nvar KintoneResponseHandler =\n/** @class */\nfunction () {\n  function KintoneResponseHandler(_a) {\n    var enableAbortSearchError = _a.enableAbortSearchError;\n    this.enableAbortSearchError = enableAbortSearchError;\n  }\n\n  KintoneResponseHandler.prototype.handle = function (response) {\n    var _this = this;\n\n    return response.then(function (res) {\n      return _this.handleSuccessResponse(res);\n    }, function (error) {\n      return _this.handleErrorResponse(error);\n    });\n  };\n\n  KintoneResponseHandler.prototype.handleSuccessResponse = function (response) {\n    if (this.enableAbortSearchError && /Filter aborted because of too many search results/.test(response.headers[\"x-cybozu-warning\"])) {\n      throw new KintoneAbortSearchError_1.KintoneAbortSearchError(response.headers[\"x-cybozu-warning\"]);\n    }\n\n    return response.data;\n  };\n\n  KintoneResponseHandler.prototype.handleErrorResponse = function (error) {\n    if (!error.response) {\n      // FIXME: find a better way to handle this error\n      if (/mac verify failure/.test(error.toString())) {\n        throw new Error(\"invalid clientCertAuth setting\");\n      }\n\n      throw error;\n    }\n\n    var errorResponse = error.response;\n\n    var data = errorResponse.data,\n        rest = __rest(errorResponse, [\"data\"]);\n\n    if (typeof data === \"string\") {\n      throw new Error(\"\".concat(rest.status, \": \").concat(rest.statusText));\n    }\n\n    throw new KintoneRestAPIError_1.KintoneRestAPIError(__assign({\n      data: data\n    }, rest));\n  };\n\n  return KintoneResponseHandler;\n}();\n\nexports.KintoneResponseHandler = KintoneResponseHandler;","map":{"version":3,"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA;;AACA;;AAKA;AAAA;AAAA;EAEE,gCAAYA,EAAZ,EAA2E;QAA7DC,sBAAsB;IAClC,KAAKA,sBAAL,GAA8BA,sBAA9B;EACD;;EACDC,oDAAUC,QAAV,EAAwC;IAAxC;;IACE,OAAOA,QAAQ,CAACC,IAAT,CACL,UAACC,GAAD,EAAI;MAAK,YAAI,CAACC,qBAAL,CAA8BD,GAA9B;IAAkC,CADtC,EAEL,UAACE,KAAD,EAAM;MAAK,YAAI,CAACC,mBAAL,CAAyBD,KAAzB;IAA+B,CAFrC,CAAP;EAID,CALD;;EAMQL,yDAAR,UAAiCC,QAAjC,EAAsD;IACpD,IACE,KAAKF,sBAAL,IACA,oDAAoDQ,IAApD,CACEN,QAAQ,CAACO,OAAT,CAAiB,kBAAjB,CADF,CAFF,EAKE;MACA,MAAM,IAAIC,iDAAJ,CAA4BR,QAAQ,CAACO,OAAT,CAAiB,kBAAjB,CAA5B,CAAN;IACD;;IACD,OAAOP,QAAQ,CAACS,IAAhB;EACD,CAVO;;EAWAV,uDAAR,UACEK,KADF,EACsE;IAEpE,IAAI,CAACA,KAAK,CAACJ,QAAX,EAAqB;MACnB;MACA,IAAI,qBAAqBM,IAArB,CAA0BF,KAAK,CAACM,QAAN,EAA1B,CAAJ,EAAiD;QAC/C,MAAM,IAAIC,KAAJ,CAAU,gCAAV,CAAN;MACD;;MACD,MAAMP,KAAN;IACD;;IACD,IAAMQ,aAAa,GAAGR,KAAK,CAACJ,QAA5B;;IAEQ,QAAI,GAAcY,aAAa,KAA/B;IAAA,IAASC,IAAI,UAAKD,aAAL,EAAf,QAAe,CAAb;;IACR,IAAI,OAAOH,IAAP,KAAgB,QAApB,EAA8B;MAC5B,MAAM,IAAIE,KAAJ,CAAU,UAAGE,IAAI,CAACC,MAAR,EAAc,IAAd,EAAcC,MAAd,CAAmBF,IAAI,CAACG,UAAxB,CAAV,CAAN;IACD;;IACD,MAAM,IAAIC,yCAAJ,CAAuBC;MAAGT,IAAI;IAAP,GAAYI,IAAZ,CAAvB,CAAN;EACD,CAjBO;;EAkBV;AAAC,CAxCD;;AAAaM","names":["_a","enableAbortSearchError","KintoneResponseHandler","response","then","res","handleSuccessResponse","error","handleErrorResponse","test","headers","KintoneAbortSearchError_1","data","toString","Error","errorResponse","rest","status","concat","statusText","KintoneRestAPIError_1","__assign","exports"],"sources":["../src/KintoneResponseHandler.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}